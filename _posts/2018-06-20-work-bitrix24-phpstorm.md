---
layout: post
title: Способ работы с Bitrix24 КП в PHPStorm
---

И так, имеем очень жирный проект из под Bitrix24 Корпоративного портала.
Чтобы представили проект, он же со всем хламом (документы, картинки, презентации, и так же кэш) весит 500 Гб.
Пусть например проект находится по адресу example.com

Нужно настройть SFTP соединения к серверу проекта, чтобы можно во время работы внести правки чтобы смотреть за результатом.
То есть меняете код, и upload’ите его прямо через SFTP на сервер. И смотрите результат.

Получили нужный результат, комитем код в Git и пушим его.
После через консоль SSH на сервере делаете так. Получаете изменения и сбрасываете все изменения которые мы сделали через SFTP, к последнему комиту в вашей ветке.

{% highlight bash %}
git fetch origin
git reset --hard origin/{ваша ветка}
{% endhighlight %}

И вот. Так идет работа с проектом.
Конечно ядро bitrix у нас должно быть в exclude‘ах от индексации PHPStorm‘ом
Поэтому мы скачиваем ядро из сервера, и после распаковываем его за проектом куда нибудь.

Для создания архива вот инструкция архиватору, кторая исключает все что не PHP код
Например проект на сервере находится по пути **/home/bitrix/www** следовательно ядро, то есть модули находятся по **/home/bitrix/wwww/bitrix/modules**.
Переходим в **/home/bitrix** и запускаем архиватор.

{% highlight bash %}
tar --exclude='*.zip' --exclude='*.jpg' --exclude='*.pdf' --exclude='*.doc' --exclude='*.exe' --exclude='*.swf' --exclude='*.swz' --exclude='*.rar' --exclude='*.docx' --exclude='*.xls' --exclude='*.log' --exclude='*.mp4' --exclude='*.xlsx' --exclude='*.gz' --exclude='*.gif' --exclude='*.7z' --exclude='*.pptx' --exclude='*.jpeg' --exclude='*.JPG' --exclude='*.png' --exclude='*.js' --exclude='*.css' --exclude='*.html' -cvzf core.tar www/bitrix/modules/
{% endhighlight %}

Он создаст архив /home/bitrix/core.tar ~ 70 mb по весу.
Далее его нужно скачать, например сюда /home/user/Desktop и распаковать.
получим нечто /home/user/Desktop/www/bitrix/modules/*
Вводите IP вашего сервера и скачиваете архив ядра.

{% highlight bash %}
scp root@999.999.999.999:/home/bitrix/core.tar /home/user/Desktop/
{% endhighlight %}

Далее распаковали архив. Теперь нужно скормить их PHPStorm‘у чтобы он знал про модули и компоненты.


![Скриншот настроек](/images/settings.png)

Вот теперь в автодополнении будут выползать все нужные API‘шки модулей. И не будут выползать во время поиска c Ctrl+Shift+F

У такого вариант есть минус один, если Ядро битрикса на сервере обновили и вам нужны новые фишки из модулей то придется все повторить процедуру.
Вот так вот работается с Bitrix24 жирными проектами у меня. Пока.

В внутри модулях имеется компоненты, поэтому нет необходимости проделовать так же отдельно для /bitrix/components/
ведь они инсталируются из директории в модулях install

Резюмирую:
Работаю вношу правки через SFTP в проект на сервере, менеджеры проверяют и утверждают типа ОК.
Я потом комичу все нужные измения по комитам и пушу в GitLab. И сбрасываю все измения на сервере, привожу к идентичности по ветке.
И после опять проверяю так проект на сервере. После, мержу все в мастер ветку и выкатываю в боевой проект.

