---
layout: post
title: CPU是如何工作的
---

#### CPU怎么工作的
CPU内部主要是由**运算器**和**控制器**组成，CPU内部就相当于一个工厂的流水线，内存就相当于工厂的临时仓库。  
&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;[![CPU.png](https://i.postimg.cc/PxdQ9R7b/CPU.png)](https://postimg.cc/sB0WZws1)

<br/>当我们打开一个程序的时候，和这个程序相关的数据就会从硬盘被传输到内存，这些被临时存储的程序数据，就等着被CPU提取，而内存里面的数据主要就是这个程序的数据和指令，数据就相当于马上要被加工的原材料，而指令就相当于客户的订单，订单上面写的就是对产品的要求。
```
graph LR
内存仓库-->指令订单+数据原材料
```

<br/>既然我们的内存相当于是仓库，CPU是流水线，工厂自然就有负责在仓库取货的工人，负责取货的工人主要有3个：
- **程序计数器**：主要负责告诉工厂即将要用到的原材料在仓库的具体位置
- **地址寄存器**：我们知道CPU的速度要比内存快得多，所以主要是负责记录正在提取的原材料在内存的具体位置
- **数据寄存器**：主要负责整个CPU工厂数据的分发，也就是从外面进来的和已经生产好的货物都要经过它来中转  

这里再补充一点，我们说的这个寄存器和我们熟悉的硬盘、内存都是用来存储数据的，只不过在电脑的存储组件里，++寄存器是速度最快的++。
![image](https://oscimg.oschina.net/oscnet/be8fadfe9942317e581a5158e31d0a2f0af.jpg)

<br/>**寄存器存在的意义是什么**？我们知道CPU的速度要比硬盘、内存快很多，我们理解成我们在桌子上写作业，书柜想象成内存，我们要用什么书，都要起身去书柜拿，就耽误了我们时间，这个时候我们在旁边放一个小桌子，提前把要用的书从书柜拿下来，放在旁边的小桌子上，小桌子就好比我们的寄存器，我们再拿书的时候，随手一拿就可以了，所以CPU的缓存、寄存器基本就是这个意思。  
<br/>

**CPU工厂流程：**  
第1步：看客户订单，CPU在内存提取指令，到我们的指令寄存器；
[![1.png](https://i.postimg.cc/gkcVP0Wf/1.png)](https://postimg.cc/WtKFGTtn)

第2步：对指令进行译码，分析客户订单，看看指令的要求，需要用到的工种、设备之类的东西  
[![2.png](https://i.postimg.cc/JnrBbTPG/2.png)](https://postimg.cc/Ff6Rvxt4)

第3步：生产阶段，执行指令，操作控制器就要按照计划好的订单，要所有参与这次生产的设备准备好，各就各位准备开工。数据寄存器就要把数据提起出来，传给算数逻辑单元。算数逻辑单元有个累加寄存器和程序状态寄存器，累加寄存器就相当于草稿纸，运算过程中的一些数据和结果会临时保存到这个地方。程序状态寄存器负责记录运算有没有进位、溢出之类的信息。  
[![3.png](https://i.postimg.cc/Y93RBnXH/3.png)](https://postimg.cc/1n8wpHhC)  

第4步：访存取数，就是结果写回。算数寄存器把结果再传给数据寄存器  
[![4.png](https://i.postimg.cc/MGScwWMC/4.png)](https://postimg.cc/CRcMHp47)

现在，CPU工厂算完成一次计算，在实际工作中，CPU就是不断循环刚才的流程，而且是每秒钟几十亿次的循环。

另外，在CPU中很重要的组件就是时钟发生器，这个东西专门安排工作，比如告诉数据寄存器3秒钟之后去内存取货，4秒钟后指令寄存器接收指令，5秒钟之后开始指令译码，6秒钟之后把数据反馈给内存，这样CPU内部各个组件才可以有条不紊的工作。
